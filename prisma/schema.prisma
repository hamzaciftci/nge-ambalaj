generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("STORAGE_POSTGRES_PRISMA_URL")
  directUrl = env("STORAGE_DATABASE_URL_UNPOOLED")
}

enum Role {
  ADMIN
  SUPER_ADMIN
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  passwordHash String
  name         String?
  role         Role      @default(ADMIN)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  sessions     Session[]
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model MainCategory {
  id            String        @id @default(cuid())
  slug          String        @unique
  name          String
  nameEn        String?
  description   String        @db.Text
  descriptionEn String?       @db.Text
  image         String
  order         Int           @default(0)
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  subCategories SubCategory[]
}

model SubCategory {
  id             String       @id @default(cuid())
  slug           String
  name           String
  nameEn         String?
  description    String       @db.Text
  descriptionEn  String?      @db.Text
  image          String?
  order          Int          @default(0)
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  mainCategoryId String
  mainCategory   MainCategory @relation(fields: [mainCategoryId], references: [id], onDelete: Cascade)
  products       Product[]

  @@unique([mainCategoryId, slug])
}

model Product {
  id                String         @id @default(cuid())
  slug              String
  name              String
  nameEn            String?
  description       String         @db.Text
  descriptionEn     String?        @db.Text
  longDescription   String?        @db.Text
  longDescriptionEn String?        @db.Text
  image             String
  order             Int            @default(0)
  isActive          Boolean        @default(true)
  isFeatured        Boolean        @default(false)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  subCategoryId     String
  subCategory       SubCategory    @relation(fields: [subCategoryId], references: [id], onDelete: Cascade)
  images            ProductImage[]

  @@unique([subCategoryId, slug])
}

model ProductImage {
  id        String   @id @default(cuid())
  url       String
  alt       String?
  order     Int      @default(0)
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model SiteSettings {
  id             String   @id @default("default")
  siteName       String   @default("NGE Ambalaj")
  siteNameEn     String?
  phone          String?
  phone2         String?
  email          String?
  whatsapp       String?
  address        String?  @db.Text
  addressEn      String?  @db.Text
  workingHours   String?  @db.Text
  workingHoursEn String?  @db.Text
  mapEmbedUrl    String?  @db.Text
  socialLinks    Json?    // { facebook, instagram, linkedin, twitter, youtube }
  logoUrl        String?
  faviconUrl     String?
  footerText     String?  @db.Text
  footerTextEn   String?  @db.Text
  // SEO defaults
  defaultSeoTitle       String?
  defaultSeoTitleEn     String?
  defaultSeoDescription String? @db.Text
  defaultSeoDescriptionEn String? @db.Text
  updatedAt      DateTime @updatedAt
}

// Page content management (hakkimizda, iletisim, etc.)
model Page {
  id              String   @id @default(cuid())
  slug            String   @unique // anasayfa, hakkimizda, iletisim
  title           String
  titleEn         String?
  content         Json     // Flexible JSON content for page sections
  contentEn       Json?
  seoTitle        String?
  seoTitleEn      String?
  seoDescription  String?  @db.Text
  seoDescriptionEn String? @db.Text
  seoKeywords     String?
  seoKeywordsEn   String?
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// Homepage hero slider
model HeroSlide {
  id              String   @id @default(cuid())
  title           String
  titleEn         String?
  subtitle        String?
  subtitleEn      String?
  buttonText      String?
  buttonTextEn    String?
  buttonLink      String?
  imageDesktop    String   // Desktop image URL
  imageMobile     String?  // Mobile image URL (optional)
  order           Int      @default(0)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  company   String?
  subject   String?
  message   String   @db.Text
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

// Navigation menu management
model MenuItem {
  id          String     @id @default(cuid())
  title       String     // Display title
  titleEn     String?    // English title
  href        String?    // Link URL (null for dropdown parents)
  target      String?    // _blank, _self, etc.
  icon        String?    // Icon name (optional)
  order       Int        @default(0)
  isActive    Boolean    @default(true)
  parentId    String?    // For nested menus
  parent      MenuItem?  @relation("MenuChildren", fields: [parentId], references: [id], onDelete: Cascade)
  children    MenuItem[] @relation("MenuChildren")
  menuType    String     @default("header") // header, footer, mobile
  // Special flags
  isProductsMenu Boolean @default(false) // Auto-populate with product categories
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}
